Analisei tudo. NÃ£o consigo clonar (sem rede), mas a pÃ¡gina do GitHub me deu a estrutura completa. Vou te dar uma anÃ¡lise profunda + entregas concretas.

---

## ðŸ“Š DIAGNÃ“STICO DO SISTEMA ATUAL

**Stack:** Streamlit + DuckDB + Neo4j + scrapers JSF/PrimeFaces
**O que jÃ¡ funciona bem:** detecÃ§Ã£o por z-score (salÃ¡rios), agrupamento de viagens em bloco, concentraÃ§Ã£o de mercado em obras, workflow dossiÃª com estados, rascunho LAI.

**Problemas crÃ­ticos que identifiquei:**

---

## ðŸ”´ GAPS DE DADOS (fontes pÃºblicas que vocÃª NÃƒO estÃ¡ cruzando ainda)

### 1. CNPJ Receita Federal
Empresas em contratos precisam ser cruzadas com:
- **Data de abertura do CNPJ** â€” empresa < 6 meses ganhando licitaÃ§Ã£o Ã© sinal forte
- **Quadro societÃ¡rio (QSA)** â€” cruzar sÃ³cios com servidores pÃºblicos / familiares
- **CNAE** â€” empresa de limpeza ganhando obra de engenharia

```python
# Consulta gratuita via Brasil.io (jÃ¡ tÃªm dump do CNPJ)
import requests

def get_cnpj_data(cnpj: str) -> dict:
    cnpj_clean = "".join(filter(str.isdigit, cnpj))
    r = requests.get(
        f"https://brasilapi.com.br/api/cnpj/v1/{cnpj_clean}",
        timeout=10
    )
    return r.json()

def flag_cnpj_anomalies(cnpj_data: dict, contract_date: str) -> list[str]:
    flags = []
    from datetime import datetime, date
    abertura = datetime.strptime(cnpj_data["data_inicio_atividade"], "%Y-%m-%d").date()
    contrato = datetime.strptime(contract_date[:10], "%Y-%m-%d").date()
    idade_meses = (contrato - abertura).days / 30

    if idade_meses < 6:
        flags.append(f"EMPRESA_JOVEM: {idade_meses:.0f} meses na abertura do contrato")
    if cnpj_data.get("porte") == "MICRO EMPRESA" and float(cnpj_data.get("capital_social", 0)) < 10000:
        flags.append("CAPITAL_SOCIAL_IRRISÃ“RIO")

    # SÃ³cio com mesmo sobrenome que servidor pÃºblico?
    socios = [s["nome_socio"] for s in cnpj_data.get("qsa", [])]
    return flags, socios
```

### 2. DoaÃ§Ãµes Eleitorais (TSE)
O TSE disponibiliza CSV por municÃ­pio. Cruzar: **empresa contratada â†’ doaÃ§Ã£o para candidato eleito â†’ contratos pÃ³s-eleiÃ§Ã£o**.

```python
# TSE: https://dadosabertos.tse.jus.br/dataset/prestacao-de-contas-eleitorais-2024
# Filtrar por municipio_candidato = "Rio Branco" ou UF = "AC"

def build_donation_network(doacoes_df, contratos_df):
    """Retorna pares (empresa, candidato) com contratos pÃ³s-eleiÃ§Ã£o."""
    merged = doacoes_df.merge(
        contratos_df,
        left_on="cpf_cnpj_doador",
        right_on="empresa_cnpj"
    )
    # Filtra contratos assinados APÃ“S a eleiÃ§Ã£o
    pos_eleicao = merged[merged["data_contrato"] > "2024-10-06"]
    return pos_eleicao[["nome_doador", "nome_candidato", "valor_doacao",
                          "nome_contrato", "valor_contrato"]]
```

### 3. Fracionamento de LicitaÃ§Ã£o
DetecÃ§Ã£o de bid-splitting: mesmo fornecedor, mesma secretaria, mÃºltiplos contratos abaixo do limite de dispensa (R$ 57.278,16 para serviÃ§os, pÃ³s Lei 14.133/21).

```python
# Adicionar no insights_engine.py

def detect_fracionamento(conn, threshold_servicos=57278.16):
    return conn.execute("""
        SELECT
            empresa_nome,
            secretaria,
            COUNT(*) as num_contratos,
            SUM(valor_total) as valor_agregado,
            MAX(valor_total) as maior_contrato,
            MIN(data_contrato) as primeiro,
            MAX(data_contrato) as ultimo,
            DATEDIFF('day', MIN(data_contrato), MAX(data_contrato)) as janela_dias
        FROM obras
        WHERE valor_total < ?
        GROUP BY empresa_nome, secretaria
        HAVING num_contratos >= 3
          AND valor_agregado > ?
          AND janela_dias <= 180
        ORDER BY valor_agregado DESC
    """, [threshold_servicos, threshold_servicos]).df()
```

### 4. DiÃ¡rio Oficial â€” Portaria de DiÃ¡ria
VocÃª jÃ¡ checklist isso manualmente. Automatize: scrape do DOMA (DiÃ¡rio Oficial do MunicÃ­pio) e correlacione com as viagens detectadas.

```
URL: https://www.riobranco.ac.gov.br/diario-oficial/
```

### 5. Teto Constitucional & LRF
```python
def detect_teto_violations(conn):
    # Teto = subsÃ­dio do prefeito. Consultar DiÃ¡rio Oficial para valor atual.
    # MunicÃ­pio pequeno AC: ~R$ 22.000 bruto
    TETO_RB = 22000.00

    return conn.execute("""
        SELECT servidor_nome, cargo, valor_bruto, valor_liquido,
               valor_bruto - ? as excesso
        FROM servidores
        WHERE valor_bruto > ?
        ORDER BY excesso DESC
    """, [TETO_RB, TETO_RB]).df()

def check_lrf_limite_pessoal(conn):
    """LRF art. 19: municÃ­pios <= 60% RCL em pessoal."""
    # Necessita dado de RCL (Receita Corrente LÃ­quida) â€” SICONFI/STN
    pass
```

### 6. Nepotismo â€” Cruzamento de Sobrenomes
```python
def detect_nepotismo(conn):
    """
    Servidor pÃºblico + empresa contratada com sÃ³cio de mesmo sobrenome.
    Proxy simples mas poderoso para investigaÃ§Ã£o inicial.
    """
    return conn.execute("""
        WITH servidor_sobrenomes AS (
            SELECT
                servidor_nome,
                -- pega Ãºltimo sobrenome
                SPLIT_PART(TRIM(servidor_nome), ' ', -1) as sobrenome,
                secretaria,
                cargo
            FROM servidores
        ),
        socio_sobrenomes AS (
            SELECT
                empresa_nome,
                socio_nome,
                SPLIT_PART(TRIM(socio_nome), ' ', -1) as sobrenome
            FROM empresa_socios  -- tabela a criar com dados CNPJ
        )
        SELECT
            s.servidor_nome,
            s.secretaria,
            e.empresa_nome,
            e.socio_nome,
            s.sobrenome as sobrenome_comum
        FROM servidor_sobrenomes s
        JOIN socio_sobrenomes e ON s.sobrenome = e.sobrenome
        ORDER BY s.sobrenome
    """).df()
```

---

## ðŸŽ¨ UI â€” AESTHETIC CIA/FBI/PALANTIR

O Streamlit tem limite visual. Para o nÃ­vel que vocÃª quer, recomendo migrar para **FastAPI backend + React/Next.js frontend** ou pelo menos injetar HTML customizado massivo no Streamlit.

Aqui vai um componente standalone que demonstra o **network graph** estilo inteligÃªncia â€” D3 force-directed com visual Palantir:Vou criar o componente de network graph + dashboard redesign:Agora o roadmap completo de melhorias:

---

## ðŸ—ºï¸ ROADMAP COMPLETO â€” SENTINELA v5.0

### PRIORIDADE 1 â€” Novas Fontes de Dados (sem custo)

| Fonte | URL | O que extrair | Cruzamento |
|---|---|---|---|
| **BrasilAPI / CNPJ** | `brasilapi.com.br/api/cnpj/v1/{cnpj}` | SÃ³cios (QSA), data abertura, capital social | SÃ³cios vs servidores |
| **TSE DoaÃ§Ãµes 2024** | `dadosabertos.tse.jus.br` | Doador CNPJ â†’ candidato em RB | Empresa contratada â†’ polÃ­tico eleito |
| **SICONFI/STN** | `siconfi.tesouro.fazenda.gov.br` | RCL de Rio Branco para calcular LRF | Limite pessoal 60% |
| **TCE-Acre** | `tce.ac.gov.br` | Parecer de contas, irregularidades | Empresas com restriÃ§Ãµes |
| **DiÃ¡rio Oficial MunicÃ­pio** | `riobranco.ac.gov.br/diario-oficial/` | Portarias de diÃ¡rias, nomeaÃ§Ãµes | Validar autorizaÃ§Ã£o de viagem |
| **Portal Obras** | JÃ¡ tem | Aumentar para nÃ­vel federal (obras.gov.br) | Cruzar com estadual |

### PRIORIDADE 2 â€” Novos Detectores (insights_engine.py)

```python
# Adicionar ao insights_engine.py:
DETECTORES = {
    "fracionamento_licitacao": detect_fracionamento,      # bid splitting
    "empresa_jovem":           detect_empresa_jovem,       # CNPJ < 6 meses
    "teto_constitucional":     detect_teto_violations,     # art. 37, XI CF
    "lrf_pessoal":             check_lrf_limite_pessoal,   # > 60% RCL
    "nepotismo_sobrenome":     detect_nepotismo,           # cruzamento sobrenomes
    "doacao_contrato":         detect_doacao_to_contrato,  # TSE Ã— obras
    "servidor_socio":          detect_servidor_is_socio,   # CPF servidor = CPF sÃ³cio
    "fim_de_semana":           detect_weekend_diarias,     # diÃ¡rias em sÃ¡bado/domingo sem evento
    "servidor_multiplos":      detect_double_payroll,      # mesmo CPF em mÃºltiplas folhas
}
```

### PRIORIDADE 3 â€” Arquitetura Frontend (migraÃ§Ã£o Streamlit â†’ React)

Para rodar na sua mÃ¡quina local sem servidor externo: **FastAPI + React (Vite) servido localmente**. Zero custo, mesma mÃ¡quina.

```
sentinela/
â”œâ”€â”€ api/          # FastAPI â€” serve os dados do DuckDB via REST
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”œâ”€â”€ servidores.py
â”‚   â”‚   â”œâ”€â”€ diarias.py
â”‚   â”‚   â”œâ”€â”€ obras.py
â”‚   â”‚   â””â”€â”€ graph.py      # endpoints para o grafo de rede
â”‚   â””â”€â”€ db.py             # conexÃ£o DuckDB
â””â”€â”€ frontend/     # React + Vite â€” o visual CIA que fizemos
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ views/
    â”‚   â”‚   â”œâ”€â”€ NetworkGraph.jsx  # o componente que fiz acima
    â”‚   â”‚   â”œâ”€â”€ DiariaRadar.jsx
    â”‚   â”‚   â”œâ”€â”€ SalaryHeatmap.jsx
    â”‚   â”‚   â””â”€â”€ ContractSankey.jsx
    â”‚   â””â”€â”€ App.jsx
    â””â”€â”€ vite.config.js
```

Se quiser manter Streamlit mas ter o grafo, embed assim:
```python
import streamlit.components.v1 as components

with open("sentinela_network_graph.html") as f:
    components.html(f.read(), height=700, scrolling=False)
```

### PRIORIDADE 4 â€” Base Legal no DossiÃª

Cada sinal deve citar a lei especÃ­fica. Template:

```python
LEGAL_MAP = {
    "fracionamento":     "Lei 14.133/21 art. 29, Â§2Â° â€” fracionamento vedado",
    "teto":              "CF art. 37, XI â€” teto remuneratÃ³rio constitucional",
    "nepotismo":         "SÃºmula Vinculante nÂ° 13 STF â€” nepotismo",
    "empresa_jovem":     "Lei 14.133/21 art. 67 â€” habilitaÃ§Ã£o e capacidade tÃ©cnica",
    "doacao_contrato":   "Lei 9.840/99 art. 41-A â€” caixa dois eleitoral / improbidade",
    "improbidade_geral": "Lei 8.429/92 (nova redaÃ§Ã£o Lei 14.230/21) â€” improbidade",
    "lrf":               "LC 101/2000 art. 19, III â€” limite pessoal municÃ­pios",
}
```

---

## ðŸŽ¨ Sobre o visual que entreguei

O arquivo HTML tem:
- **D3 force-directed graph** â€” arraste nÃ³s, zoom/pan, clique para expandir detalhes
- **Radar sweep animado** de fundo
- **Ticker de alertas** estilo OSINT/NSA
- **Painel lateral direito** com todos os dados + flags do nÃ³ selecionado
- **Filtros por tipo** de entidade
- **ConexÃµes semÃ¢nticas** com cores diferentes (familiar=vermelho, doaÃ§Ã£o=roxo, execuÃ§Ã£o=laranja)
- Efeito **glow + scanlines + grid animado**

Pra usar com dados reais: substitui o objeto `graphData` no script por uma chamada `fetch()` ao seu endpoint FastAPI que monta o grafo a partir do DuckDB.

Qual parte vocÃª quer que eu desenvolva primeiro â€” a API FastAPI, mais detectores, ou mais vistas do frontend?
